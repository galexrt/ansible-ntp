---
- name: Install ntp package
  action: "{{ ansible_pkg_mgr }}"
  args:
    name: "{{ item }}"
    state: latest
  with_items:
   - ntpdate

- name: Stop ntpd service (rhel)
  service:
    name: ntpd
    state: stopped
   when: ansible_distribution != "Debian" and ansible_distribution != "Ubuntu"

- name: Stop ntpd service (deb)
  service:
    name: ntp
    state: stopped
  when: ansible_distribution == "Debian" or ansible_distribution == "Ubuntu"

- name: Execute ntpdate
  command: "ntpdate -s {{ ntpdate_server|default('0.de.pool.ntp.org') }}"
  notify:
    - start ntpd (rhel)
    - start ntpd (deb)
